{% comment %}
  Custom additions to <head>: favicons + theme initialization.
{% endcomment %}

<!-- Favicons (placed in site root) -->
<link rel="icon" href="{{ '/favicon.svg' | relative_url }}" type="image/svg+xml">
<link rel="icon" href="{{ '/favicon-32x32.png' | relative_url }}" sizes="32x32" type="image/png">
<link rel="icon" href="{{ '/favicon-16x16.png' | relative_url }}" sizes="16x16" type="image/png">
<link rel="apple-touch-icon" href="{{ '/apple-touch-icon.png' | relative_url }}" sizes="180x180">
<link rel="shortcut icon" href="{{ '/favicon.ico' | relative_url }}">

<script>
  (() => {
    const STORAGE_KEY = "theme";
    const root = document.documentElement;

    const systemPrefersDark = () =>
      window.matchMedia &&
      window.matchMedia("(prefers-color-scheme: dark)").matches;

    const currentTheme = () => (root.dataset.theme === "dark" ? "dark" : "light");

    const applyTheme = (theme) => {
      if (theme === "dark") root.dataset.theme = "dark";
      else root.removeAttribute("data-theme");
    };

    const setTheme = (theme) => {
      applyTheme(theme);
      try { localStorage.setItem(STORAGE_KEY, theme); } catch (e) {}
    };

    // Apply initial theme ASAP (prevents flash)
    let initial = null;
    try { initial = localStorage.getItem(STORAGE_KEY); } catch (e) {}
    applyTheme(initial || (systemPrefersDark() ? "dark" : "light"));

    // Wire up the button once DOM exists
    document.addEventListener("DOMContentLoaded", () => {
      const btn = document.getElementById("theme-toggle");
      if (!btn) return;

      const render = () => {
        const isDark = currentTheme() === "dark";
        btn.setAttribute("aria-pressed", String(isDark));
        btn.textContent = isDark ? "â˜€ï¸" : "ðŸŒ™";
        btn.title = isDark ? "Switch to light theme" : "Switch to dark theme";
      };

      render();

      btn.addEventListener("click", () => {
        const next = currentTheme() === "dark" ? "light" : "dark";
        setTheme(next);
        render();
      });
    });
  })();
</script>
